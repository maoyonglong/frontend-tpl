!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Tpl=e()}(this,function(){"use strict";var g=0,y=1,m=2,w=3,x=4,E=5,S=6,v=7,b=8,T=9,N=10,G=11,L=12,A=13,Q=14,D=15,_=16,q=17,H=18,R={single:["input","img","br","hr","link","meta"],isSingle:function(t){return 0<=this.single.indexOf(t)},isDouble:function(t){return this.single.indexOf(t)<0}},C={isLetter:function(t){return/[a-zA-Z]/.test(t)},isLg:function(t){return"<"===t},isGt:function(t){return">"===t},isExclamatory:function(t){return"!"===t},isHyphen:function(t){return"-"===t},isSlash:function(t){return"/"===t},isSpace:function(t){return" "===t},isEqual:function(t){return"="===t},isSingleQuote:function(t){return"'"===t},isDoubleQuote:function(t){return'"'===t},isQuote:function(t){return this.isSingleQuote(t)||this.isDoubleQuote(t)}};function t(){this.p=0,this.len=0}function n(){}function s(t,n){var e=t.match(/\{\{(.*)\}\}/);if(null!==e)return e[1].replace(/(?<=[{[,+-/*\s.])\w+(?=[+-/*\s.,}\]])/g,function(t,e){return n[t]?"data.".concat(t):t})}function c(t,e){return new Function("data","return ".concat(t))(e)}function i(){this.parser=new t,this.renderer=new n}function e(t,e){this.str=t,this.data=e,this.compiler=new i}return t.prototype.parse=function t(e){var n,i=0===this.p,r=g,o=[],s="",c="",a="",u="",p="",h="",l="",f="";for(this.len=e.length;this.p<this.len;){var d=e.charAt(this.p);switch(r){case g:n={},o.push(n),C.isLg(d)?(r=y,f=d):(r=N,n.type="text",u=d),this.p++;continue;case y:if(C.isExclamatory(d))r=D;else if(C.isLetter(d))r=m,n.type="tag",s=d;else{if(!C.isSpace(d)){if(i)throw new Error("The tag name is illegal in ".concat(this.p,"."));return this.p--,o.pop(),o}r=N,n.type="text",u=f+d,f=""}this.p++;continue;case m:if(C.isLetter(d))s+=d;else if(C.isSpace(d))r=w,n.tag=s;else{if(!C.isGt(d))throw new Error("The tag name is illegal in ".concat(this.p,"."));r=E,n.tag=s}this.p++;continue;case w:C.isSlash(d)||C.isSpace(d)||(r=G,c=d),C.isSlash(d)&&(r=x,f=d),C.isGt(d)&&(r=E),this.p++;continue;case x:C.isGt(d)&&(r=E),this.p++;continue;case E:if(R.isSingle(s)){r=g,s="";continue}if(C.isSlash(f))throw new Error("The ".concat(s," is not a single tag."));C.isLg(d)?(r=S,this.p++):n.children=t.call(this,e);continue;case S:f="",C.isSlash(d)?r=b:(this.p--,n.children=t.call(this,e)),this.p++;continue;case b:if(C.isSpace(d)||C.isGt(d)||C.isSlash(d))throw new Error("A letter is expected in ".concat(this.p," but got ").concat(d,"."));r=v,f+=d,this.p++;continue;case v:if(C.isSlash(d))throw new Error("A letter is expected in ".concat(this.p," but got ").concat(d,"."));C.isGt(d)?r=T:f+=d,this.p++;continue;case T:if(s!==f)throw new Error("The tag name is not similar in ".concat(this.p-1));if(!R.isDouble(s))throw new Error("The ".concat(s," is not a double tag in ").concat(this.p-1));s="",r=g;continue;case N:C.isLg(d)?(n.text=u.trim(),""===n.text&&o.pop(),u="",r=g):(u+=d,this.p++);continue;case G:C.isSpace(d)?r=L:C.isEqual(d)?r=A:c+=d,this.p++;continue;case L:C.isSpace(d)||C.isEqual(d)||(r=G),C.isEqual(d)&&(r=A),this.p++;continue;case A:C.isQuote(d)&&(r=Q,h=d),this.p++;continue;case Q:d!==h?a+=d:(r=w,void 0===n.attrs&&(n.attrs={}),n.attrs[c]=a,a=""),this.p++;continue;case D:if(!C.isHyphen(d))throw new Error("'-' is expected in ".concat(this.p," but got ").concat(d,"."));n.type="note",r=_,l="left",this.p++;continue;case _:if(C.isHyphen(d));else if(C.isGt(d))r=H,f=d;else{if("left"!==l)throw new Error("'-' or '>' is expected in ".concat(this.p," but got ").concat(d,"."));r=q,p+=d}this.p++;continue;case q:if(C.isHyphen(d))r=_,l="right";else{if(C.isGt(d))throw new Error("'-' is expected in ".concat(this.p," but got ").concat(d,"."));p+=d}this.p++;continue;case H:n.text=p,l=p="",r=g;continue}}return"text"===n.type&&(n.text=u.trim(),""===n.text&&o.pop()),"note"===n.type&&(n.note=p),this.p=0,o},n.prototype.render=function i(t,r){var o=this,s=[];return t.forEach(function(t){var e=null,n=t.type;"text"===n?(e=document.createTextNode(t.text),o.handleTextNode(e,t,r)):"note"===n?(e=document.createComment(t.note),o.handleNoteNode(e,t,r)):"tag"===n&&(e=document.createElement(t.tag),o.handleTagNode(e,t,r)),t.children&&i.call(o,t.children,r).forEach(function(t){e.appendChild(t)}),s.push(e)}),s},n.prototype.handleTextNode=function(t,e,n){var i=e.text;t.nodeValue=c(s(i,n),n)||i},n.prototype.handleNoteNode=function(t,e,n){var i=e.note;t.nodeValue=c(s(i,n),n)||i},n.prototype.handleTagNode=function(t,e,n){var i=e.attrs;if(i)for(var r in i){var o=i[r];t.setAttribute(r,c(s(o,n),n)||o)}},i.prototype.parse=function(t){return this.parser.parse(t)},i.prototype.render=function(t,e){return this.renderer.render(t,e)},i.prototype.overrideRender=function(t,e){n.prototype[t]=e},e.prototype.parse=function(t){return this._ast=this.compiler.parse(t||this.str),this},e.prototype.render=function(t){return this._dom=this.compiler.render(t.ast||this._ast,t.data||this.data),this},e.prototype.overrideRender=function(t,e){return this.compiler.overrideRender(t,e),this},e.prototype.getAst=function(){return this._ast},e.prototype.getDom=function(){return this._dom},e});
